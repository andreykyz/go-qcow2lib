Go qcow2 file library introduction
==================================
This package provides a Golang-implemented qcow2 file handling library, which is largely ported from the qemu but doesn't implement all the functionalities of qemu, just a core set of functionalities of qemu.  **So far the library is still experimental. **

The purpose of implementing this library in Golang is to provide a way to use the thin-provisioned file storage in qcow2 format for any block storage-related application, such as provisioning a qcow2-based backend block storage for containers in a cloud-native environment. 

The following functionalities of qemu have been supported by the go-qcow2lib: 

- General qcow2 file operation (e.g. create, open, close, write, read) 
- Subcluster. 
- Backing file chain. (external snapshot), not stable yet. 
- L2 and refcount caches. 

And following functionalities of qemu will not be supported by the go-qcow2lib: 

- Internal snapshot (reason: internal snapshot is not a good choice for productions, suggest using external snapshot instead)
- Compression (reason: don't see many adoptions of this feature from real practices)
- Lazy refcounts (reason: avoid inconsistency?)
- Header extension (optional sections in headers) is not supported. However you can open the qcow2 file with header extension by the go-qcow2lib, but will ignore that extension. 
- Bitmaps extension, like not support the header extension feature, neither is this feature. 

And following features have not been supported by current implementation but are on the way to be done in the future: 
- external data file 
- encryption (LUKS only)

The qcow2 files generated by the go-qcow2 library don't support configurable qcow2 format-related options like what qemu implemented(e.g. cluster size, ref count entry size, etc.), however, the library uses fixed qcow2-format options and 
takes the default value of qemu's implementation for the implementation, see the following limitations: 
- A fixed cluster size value of 64 KiB, a fixed sub-cluster size of 2 KiB if enabled 
- A fixed qcow2 version of 3. 
- A fixed refcount_bits of 16 or refcount_order of 4.  
- The size of a qcow2 file is limited to 4 TiB. 

The l2 cache and refcount cache of the qcow2 library is always automatically allocated large enough according to the virtual size of the opened qcow2 file, however, you can also specify the l2 cache for a new opened qcow2 file, refcount cache is always the half of the l2 cache. basically the size of cache can be obtained by below calculation: 
- 512 MiB virtual size of qcow2 file needs 64 KiB l2 cache.
- 1 GiB virtual size of qcow2 file needs 128 KiB l2 cache. 
- 8 GiB virtual size of qcow2 file needs 1 MiB l2 cache. 
- 1 TiB virtual size of qcow2 file needs 128 MiB l2 cache. 
- ...... 

Quick Start 
===========
See [Examples](https://github.com/dypflying/go-qcow2lib/tree/main/examples) 

Qcow2 Utility 
==============
```shell
make 
bin/qcow2util create <-f filename> <-s filesize> [-b backingfile] [--enable-subcluster]
bin/qcow2util info <-f filename> [--pretty]
bin/qcow2util dd <-i inputfile> [-f inputformat] <-o outputfile> <-O outputformat> [--l2-cache-size=size]
```

License 
=======
MIT License

Copyright (c) Yunpeng Deng(dypflying)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

Report Issues 
=============
Please report bugs to [GitHub Issue Tracker](https://github.com/dypflying/go-qcow2lib/issues) 


Contact Author
==============
- Author: Yunpeng Deng (dypflying)
- Mailto: dypflying@sina.com

Either English or Chinese is welcome.